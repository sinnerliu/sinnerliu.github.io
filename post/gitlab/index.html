<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>GitLab_本地GitLab服务器搭建 - 终点站</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="死性不改" />
  <meta name="description" content="GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务

" />
<meta name="keywords" content="git, gitlab" />



<meta name="baidu-site-verification" content="YJeWJgGuC5" />



<meta name="generator" content="Hugo 0.48" />


<link rel="canonical" href="https://blog.gofinall.com/post/gitlab/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" href="/favicon.ico" />
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<link href="/dist/even.min.css?v=2.7.2" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">

<meta property="og:title" content="GitLab_本地GitLab服务器搭建" />
<meta property="og:description" content="GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.gofinall.com/post/gitlab/" /><meta property="article:published_time" content="2018-02-26T15:07:55&#43;08:00"/>
<meta property="article:modified_time" content="2018-02-26T15:07:55&#43;08:00"/>
<meta itemprop="name" content="GitLab_本地GitLab服务器搭建">
<meta itemprop="description" content="GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务

">


<meta itemprop="datePublished" content="2018-02-26T15:07:55&#43;08:00" />
<meta itemprop="dateModified" content="2018-02-26T15:07:55&#43;08:00" />
<meta itemprop="wordCount" content="1614">



<meta itemprop="keywords" content="git," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GitLab_本地GitLab服务器搭建"/>
<meta name="twitter:description" content="GitLab 是一个用于仓库管理系统的开源项目，使用Git作为代码管理工具，并在此基础上搭建起来的web服务

"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">终点站</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">首页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">终点站</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">GitLab_本地GitLab服务器搭建</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-02-26 </span>
        <div class="post-category">
            
              <a href="/categories/linux/"> linux </a>
            
          </div>
        
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#系统要求">系统要求</a></li>
<li><a href="#gitlab下载">Gitlab下载</a></li>
<li><a href="#安装">安装</a>
<ul>
<li><a href="#1-install-and-configure-the-necessary-dependencies">1. Install and configure the necessary dependencies</a></li>
<li><a href="#2-add-the-gitlab-package-repository-and-install-the-package">2. Add the GitLab package repository and install the package</a>
<ul>
<li><a href="#在线安装">在线安装</a></li>
<li><a href="#离线rpm包安装">离线rpm包安装</a></li>
</ul></li>
<li><a href="#3-configure-and-start-gitlab">3.Configure and start GitLab</a></li>
</ul></li>
<li><a href="#4-browse-to-the-hostname-and-login">4.Browse to the hostname and login</a></li>
<li><a href="#问题">问题</a>
<ul>
<li><a href="#出现页面502">出现页面502</a></li>
</ul></li>
<li><a href="#配置邮件发送">配置邮件发送</a></li>
<li><a href="#日志查看">日志查看</a></li>
<li><a href="#gitlab汉化">gitlab汉化</a>
<ul>
<li><a href="#停止gitlab">停止gitlab</a></li>
<li><a href="#查看版本">查看版本</a></li>
<li><a href="#克隆获取汉化版本库">克隆获取汉化版本库</a></li>
<li><a href="#查看该汉化补丁的版本">查看该汉化补丁的版本</a></li>
<li><a href="#打汉化补丁">打汉化补丁</a></li>
<li><a href="#启动gitlab">启动gitlab</a></li>
<li><a href="#重新配置gitlab">重新配置gitlab</a></li>
</ul></li>
<li><a href="#git仓库迁移">git仓库迁移</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>GitLab 是一个用于仓库管理系统的开源项目，使用<a href="https://baike.baidu.com/item/Git" rel="noreferrer" target="_blank">Git</a>作为代码管理工具，并在此基础上搭建起来的web服务</p>

<p></p>

<h3 id="系统要求">系统要求</h3>

<p>系统：centos7 x86_64 (必须要64位系统，32位系统不能安装gitlab)</p>

<p>内存：4G</p>

<p>硬盘：10G就差不多了，没有要求</p>

<h3 id="gitlab下载">Gitlab下载</h3>

<p>官网：<a href="https://about.gitlab.com/installation/#centos-7" rel="noreferrer" target="_blank">https://about.gitlab.com/installation/#centos-7</a></p>

<p>由于官网很慢，故用国内的镜像源：<a href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/" rel="noreferrer" target="_blank">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</a></p>

<p>目前rpm包最新版本：<a href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-10.5.1-ce.0.el7.x86_64.rpm" rel="noreferrer" target="_blank">gitlab-ce-10.5.1-ce.0.el7.x86_64.rpm</a></p>

<h3 id="安装">安装</h3>

<p>官方说明：</p>

<h4 id="1-install-and-configure-the-necessary-dependencies">1. Install and configure the necessary dependencies</h4>

<p>On CentOS 7 (and RedHat/Oracle/Scientific Linux 7), the commands below will also open HTTP and SSH access in the system firewall.</p>

<pre><code>sudo yum install -y curl policycoreutils-python openssh-server
sudo systemctl enable sshd
sudo systemctl start sshd
sudo firewall-cmd --permanent --add-service=http
sudo systemctl reload firewalld
</code></pre>

<p>Next, install Postfix to send notification emails. If you want to use another solution to send emails please skip this step and <a href="https://docs.gitlab.com/omnibus/settings/smtp.html" rel="noreferrer" target="_blank">configure an external SMTP server</a> after GitLab has been installed.</p>

<pre><code>sudo yum install postfix
sudo systemctl enable postfix
sudo systemctl start postfix
</code></pre>

<p>During Postfix installation a configuration screen may appear. Select &lsquo;Internet Site&rsquo; and press enter. Use your server&rsquo;s external DNS for &lsquo;mail name&rsquo; and press enter. If additional screens appear, continue to press enter to accept the defaults.</p>

<h4 id="2-add-the-gitlab-package-repository-and-install-the-package">2. Add the GitLab package repository and install the package</h4>

<h5 id="在线安装">在线安装</h5>

<p>Add the GitLab package repository.</p>

<pre><code>curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash
</code></pre>

<p>Next, install the GitLab package. Change <code>http://gitlab.example.com</code> to the URL at which you want to access your GitLab instance. Installation will automatically configure and start GitLab at that URL. HTTPS requires <a href="https://docs.gitlab.com/omnibus/settings/nginx.html#enable-https" rel="noreferrer" target="_blank">additional configuration</a> after installation.</p>

<pre><code>sudo EXTERNAL_URL=&quot;http://gitlab.example.com&quot; yum install -y gitlab-ee
</code></pre>

<h5 id="离线rpm包安装">离线rpm包安装</h5>

<p>由于在线安装很慢，故使用上面下载的rpm包安装</p>

<pre><code class="language-shell">rpm -ivh gitlab-ce-10.5.1-ce.0.el7.x86_64.rpm
</code></pre>

<h4 id="3-configure-and-start-gitlab">3.Configure and start GitLab</h4>

<pre><code>sudo gitlab-ctl reconfigure
</code></pre>

<h3 id="4-browse-to-the-hostname-and-login">4.Browse to the hostname and login</h3>

<p>On your first visit, you’ll be redirected to a password reset screen to provide the password for the initial administrator account. Enter your desired password and you’ll be redirected back to the login screen.
The default account’s username is root. Provide the password you created earlier and login. After login you can change the username if you wish.
For configuration and troubleshooting options please see the Omnibus GitLab documentation
If you are located in China, try using <a href="https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/" rel="noreferrer" target="_blank">https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/</a></p>

<h3 id="问题">问题</h3>

<h4 id="出现页面502">出现页面502</h4>

<p>原因：由于unicorn默认使用的是8080端口，可能有其他程序占用了8080端口。</p>

<p>解决办法：打开/etc/gitlab/gitlab.rb,打开# unicorn[‘port’] = 8080 的注释，将8080修改为9090，保存后运行</p>

<pre><code>sudo gitlab-ctl reconfigure
</code></pre>

<p>修改默认80端口</p>

<pre><code>vim /etc/gitlab/gitlab.rb
</code></pre>

<p>修改external_url ‘<a href="http://localhost:8888/" rel="noreferrer" target="_blank">http://localhost:8888</a>’ 保存退出。
刷新配置：</p>

<pre><code>sudo gitlab-ctl reconfigure
</code></pre>

<p>如果端口修改后无法访问，请检查防火墙是否关闭。</p>

<p>另附gitlab重启命令（可以不执行）。</p>

<pre><code>sudo gitlab-ctl restart
</code></pre>

<h3 id="配置邮件发送">配置邮件发送</h3>

<p>官方说明：<a href="https://docs.gitlab.com/omnibus/settings/smtp.html" rel="noreferrer" target="_blank">https://docs.gitlab.com/omnibus/settings/smtp.html</a></p>

<p>修改gitlab.rb</p>

<p><code>sudo vi /etc/gitlab/gitlab.rb</code></p>

<pre><code class="language-shell">gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = &quot;smtp.server&quot;
gitlab_rails['smtp_port'] = 465
gitlab_rails['smtp_user_name'] = &quot;smtp user&quot;
gitlab_rails['smtp_password'] = &quot;smtp password&quot;
gitlab_rails['smtp_domain'] = &quot;example.com&quot;
gitlab_rails['smtp_authentication'] = &quot;login&quot;
gitlab_rails['smtp_enable_starttls_auto'] = true
gitlab_rails['smtp_openssl_verify_mode'] = 'peer'

# If your SMTP server does not like the default 'From: gitlab@localhost' you
# can change the 'From' with this setting.
gitlab_rails['gitlab_email_from'] = 'gitlab@example.com'
gitlab_rails['gitlab_email_reply_to'] = 'noreply@example.com'
</code></pre>

<p>SMTP without SSL</p>

<pre><code class="language-shell">gitlab_rails['smtp_enable'] = true;
gitlab_rails['smtp_address'] = 'localhost';
gitlab_rails['smtp_port'] = 25;
gitlab_rails['smtp_domain'] = 'localhost';
gitlab_rails['smtp_tls'] = false;
gitlab_rails['smtp_openssl_verify_mode'] = 'none'
gitlab_rails['smtp_enable_starttls_auto'] = false
gitlab_rails['smtp_ssl'] = false
gitlab_rails['smtp_force_ssl'] = false
</code></pre>

<p>修改完，重新配置</p>

<p><code>sudo gitlab-ctl reconfigure</code></p>

<p>查看日志
<code>sudo gitlab-ctl tail</code></p>

<h3 id="日志查看">日志查看</h3>

<p>unicorn日志查看：<code>gitlab-ctl tail unicorn</code></p>

<p>gitlab日志查看：<code>gitlab-ctl tail</code></p>

<h3 id="gitlab汉化">gitlab汉化</h3>

<h4 id="停止gitlab">停止gitlab</h4>

<p><code>gitlab-ctl stop</code></p>

<h4 id="查看版本">查看版本</h4>

<pre><code class="language-shell">cat /opt/gitlab/embedded/service/gitlab-rails/VERSION  
10.5.1
 
yum -y install git  
</code></pre>

<h4 id="克隆获取汉化版本库">克隆获取汉化版本库</h4>

<p><code>git clone https://gitlab.com/xhang/gitlab.git</code></p>

<h4 id="查看该汉化补丁的版本">查看该汉化补丁的版本</h4>

<pre><code class="language-shell">cat gitlab/VERSION  
10.5.1  
</code></pre>

<h4 id="打汉化补丁">打汉化补丁</h4>

<pre><code class="language-shell">cd /root/gitlab/  
git diff v10.5.1 v10.5.1-zh &gt;/tmp/10.5.1-zh.diff  

yum install patch -y  
patch -d /opt/gitlab/embedded/service/gitlab-rails -p1 &lt; /tmp/10.5.1-zh.diff  
</code></pre>

<h4 id="启动gitlab">启动gitlab</h4>

<p><code>gitlab-ctl start</code></p>

<h4 id="重新配置gitlab">重新配置gitlab</h4>

<p><code>gitlab-ctl reconfigure</code></p>

<h3 id="git仓库迁移">git仓库迁移</h3>

<p>使用git push &ndash;mirror命令迁移仓库而不丢失log</p>

<p>先了解一些git的基本参数介绍
git clone &ndash;bare</p>

<pre><code>GIT-CLONE(1)                      Git Manual                      GIT-CLONE(1)

NAME
       git-clone - Clone a repository into a new directory

SYNOPSIS
       git clone [--template=&lt;template_directory&gt;]
                 [-l] [-s] [--no-hardlinks] [-q] [-n] [--bare] [--mirror]
                 [-o &lt;name&gt;] [-b &lt;name&gt;] [-u &lt;upload-pack&gt;] [--reference &lt;repository&gt;]
                 [--depth &lt;depth&gt;] [--recursive] [--] &lt;repository&gt; [&lt;directory&gt;]
        --bare
            Make a bare GIT repository. That is, instead of creating &lt;directory&gt; and placing the administrative files
           in &lt;directory&gt;/.git, make the &lt;directory&gt; itself the $GIT_DIR. This obviously implies the -n because there
           is nowhere to check out the working tree. Also the branch heads at the remote are copied directly to
           corresponding local branch heads, without mapping them to refs/remotes/origin/. When this option is used,
           neither remote-tracking branches nor the related configuration variables are created.
</code></pre>

<p>git push &ndash;mirror</p>

<pre><code>--mirror
           Instead of naming each ref to push, specifies that all refs under refs/ (which includes but is not limited
           to refs/heads/, refs/remotes/, and refs/tags/) be mirrored to the remote repository. Newly created local
           refs will be pushed to the remote end, locally updated refs will be force updated on the remote end, and
           deleted refs will be removed from the remote end. This is the default if the configuration option
           remote.&lt;remote&gt;.mirror is set.
</code></pre>

<ul>
<li>克隆代码库</li>
</ul>

<p><code>git clone --bare git://192.168.10.XX/git_repo/project_name.git</code></p>

<ul>
<li>然后到新的 Git 服务器上创建一个新项目，比如 GitCafe，亦或是本地的私有仓库，如192.168.20.XX</li>
</ul>

<pre><code class="language-shell">  su - git
  cd /path/to/path/
  mkdir new_project_name.git
  git init --bare new_project_name.git
</code></pre>

<ul>
<li>以镜像推送的方式上传代码到 GitCafe 服务器上。请确保已经添加了公钥到新的机器上。</li>
</ul>

<pre><code class="language-shell">cd project_name.git
git push --mirror git@192.168.20.XX/path/to/path/new_project_name.git
</code></pre>

<ul>
<li>删除本地代码</li>
</ul>

<pre><code>cd ..
rm -rf project_name.git
</code></pre>

<ul>
<li>到新服务器上找到 Clone 地址，直接Clone到本地就可以了。</li>
</ul>

<pre><code>git clone git@192.168.20.XX/path/to/path/new_project_name.git
</code></pre>

<p>这种方式可以保留原版本库中的所有内容。</p>
    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/git/">git</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/mysql-utf8-utf8mb4/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">MySQL中utf8和utf8mb4的区别</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/linux%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/">
            <span class="next-text nav-default">linux 技巧： 让你的远程会话后台执行</span>
            <span class="prev-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer><p>评论</p>
		<div id="comment"></div>
  </article>
        </div>
        
  

  

  
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://blog.gofinall.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io" target="_blank" rel="nofollow">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even" target="_blank" rel="nofollow">Even</a>
	| Hosted by <a href="https://pages.coding.me" style="font-weight: bold" target="_blank" rel="nofollow">Coding Pages</a>
  </span>


  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
    <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    
      2017 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">死性不改</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/even.min.js?v=2.7.2"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?7d0cf0782b27334f7af6fece6f2e47c4";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>

<script id="baidu_push">
  (function(){
    if (window.location.hostname === 'localhost') return;
    var bp = document.createElement('script'); bp.async = true;
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
	    
		
    <script type="text/javascript" src="/dist/Valine.min-1.1.9-beta3.js"></script>
	
    <script>
		new Valine({
			el: '#comment' ,
			notify:false, 
			verify:false, 
			appId: 'oiStP1637Pxcj1BraQdcoSVS-gzGzoHsz',
			appKey: '6r81YRVbRbjbfsLeLuU7DaxV',
			placeholder: 'ヾﾉ≧∀≦)o欢迎评论!',
			path:window.location.pathname, 
			avatar:'wavatar' 
		});
    </script>
</body>
</html>
